<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whack-A-Billy</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Roboto+Mono:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #0a0a0a;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            font-family: 'Bungee', cursive;
        }
        #game-container {
            width: 100%;
            height: 100%;
            max-width: 100vw;
            max-height: 100vh;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>
    <div id="game-container"></div>
    <script>
        const CONFIG = {
            width: 1080,
            height: 1920,
            gridSize: 3,
            holeRadius: 140,
            spawnIntervalMin: 500,
            spawnIntervalMax: 1000,
            displayDuration: 750,
            gameDuration: 60
        };

        class MainScene extends Phaser.Scene {
            constructor() {
                super('MainScene');
            }

            preload() {
                this.load.image('calm', 'calm.png');
                this.load.image('shocked', 'shocked.png');
                this.load.image('annoyed', 'annoyed.png');
                this.load.image('sleeping', 'sleeping.png');
                this.load.image('golden', 'golden.png');
            }

            init() {
                this.score = 0;
                this.timeLeft = CONFIG.gameDuration;
                this.combo = 0;
                this.multiplier = 1;
                this.holes = [];
                this.activeNephew = null;
                this.isGameOver = false;
            }

            create() {
                const { width, height } = this.cameras.main;

                const bg = this.add.graphics();
                bg.fillGradientStyle(0x0f0c29, 0x0f0c29, 0x302b63, 0x24243e, 1);
                bg.fillRect(0, 0, width, height);

                this.createUI();
                this.createGrid();
                this.showIntro();
            }

            showIntro() {
                const { width, height } = this.cameras.main;
                const readyText = this.add.text(width / 2, height / 2, 'READY?', { 
                    fontSize: '200px', 
                    fill: '#ffff00', 
                    stroke: '#000', 
                    strokeThickness: 20 
                }).setOrigin(0.5).setScale(0);

                this.tweens.add({
                    targets: readyText,
                    scale: 1,
                    duration: 500,
                    ease: 'Back.easeOut',
                    onComplete: () => {
                        this.time.delayedCall(500, () => {
                            readyText.setText('GO!');
                            readyText.setFill('#00ff00');
                            this.tweens.add({
                                targets: readyText,
                                scale: 2,
                                alpha: 0,
                                duration: 500,
                                ease: 'Power2',
                                onComplete: () => {
                                    readyText.destroy();
                                    this.startGame();
                                }
                            });
                        });
                    }
                });
            }

            startGame() {
                this.time.addEvent({
                    delay: 1000,
                    callback: this.updateTimer,
                    callbackScope: this,
                    loop: true
                });

                this.scheduleNextSpawn();

                this.input.on('pointerdown', (pointer, currentlyOver) => {
                    if (currentlyOver.length === 0) {
                        this.handleMiss(pointer.x, pointer.y);
                    }
                });
            }

            createUI() {
                const { width } = this.cameras.main;
                
                this.titleText = this.add.text(width / 2, 220, 'WHACK-A-BILLY', { 
                    fontFamily: 'Bungee', 
                    fontSize: '120px', 
                    fill: '#ffffff',
                    stroke: '#000',
                    strokeThickness: 12
                }).setOrigin(0.5);

                this.scoreText = this.add.text(width / 2, 400, '00000', { 
                    fontFamily: 'Roboto Mono', 
                    fontSize: '140px', 
                    fill: '#00ffcc',
                    stroke: '#000',
                    strokeThickness: 10
                }).setOrigin(0.5);

                this.timerText = this.add.text(width / 2, 540, '60', { 
                    fontSize: '100px', 
                    fill: '#ff0055',
                    stroke: '#000',
                    strokeThickness: 5
                }).setOrigin(0.5);
            }

            createGrid() {
                const { width, height } = this.cameras.main;
                const startX = width / 2 - 320;
                const startY = height / 2 + 100;
                const spacing = 320;

                for (let row = 0; row < CONFIG.gridSize; row++) {
                    for (let col = 0; col < CONFIG.gridSize; col++) {
                        const x = startX + col * spacing;
                        const y = startY + row * spacing;

                        const hole = this.add.ellipse(x, y, CONFIG.holeRadius * 2, CONFIG.holeRadius * 1.2, 0x1a1a1a);
                        hole.setInteractive();
                        hole.on('pointerdown', () => this.handleMiss(x, y));

                        this.holes.push({ x, y });
                    }
                }
            }

            updateTimer() {
                if (this.isGameOver) return;
                this.timeLeft--;
                this.timerText.setText(this.timeLeft.toString());

                if (this.timeLeft <= 0) {
                    this.endGame();
                }
            }

            scheduleNextSpawn() {
                if (this.isGameOver) return;
                const delay = Phaser.Math.Between(CONFIG.spawnIntervalMin, CONFIG.spawnIntervalMax);
                this.time.delayedCall(delay, this.spawnNephew, [], this);
            }

            spawnNephew() {
                if (this.isGameOver) return;
                if (this.activeNephew) {
                    this.activeNephew.destroy();
                }

                const hole = Phaser.Utils.Array.GetRandom(this.holes);
                const nephew = this.add.image(hole.x, hole.y - 80, 'calm').setDisplaySize(220, 220);
                nephew.setInteractive();

                nephew.on('pointerdown', () => {
                    this.score++;
                    this.scoreText.setText(this.score.toString().padStart(5, '0'));
                    nephew.destroy();
                    this.scheduleNextSpawn();
                });

                this.activeNephew = nephew;

                this.time.delayedCall(CONFIG.displayDuration, () => {
                    if (this.activeNephew === nephew) {
                        nephew.destroy();
                        this.scheduleNextSpawn();
                    }
                });
            }

            handleMiss(x, y) {
                if (this.isGameOver) return;
                this.score = Math.max(0, this.score - 1);
                this.scoreText.setText(this.score.toString().padStart(5, '0'));
            }

            endGame() {
                this.isGameOver = true;
                if (this.activeNephew) this.activeNephew.destroy();
                this.scene.start('GameOverScene', { score: this.score });
            }
        }

        class GameOverScene extends Phaser.Scene {
            constructor() {
                super('GameOverScene');
            }

            create(data) {
                const { width, height } = this.cameras.main;

                this.add.rectangle(width / 2, height / 2, width, height, 0x000000, 0.9);

                this.add.text(width / 2, height / 2 - 200, 'GAME OVER', { 
                    fontSize: '120px', 
                    fill: '#ff0055',
                    stroke: '#fff',
                    strokeThickness: 6
                }).setOrigin(0.5);

                this.add.text(width / 2, height / 2 - 50, `Score: ${data.score}`, {
                    fontSize: '80px',
                    fill: '#00ffcc'
                }).setOrigin(0.5);

                const btnX = width / 2;
                const btnY = height / 2 + 150;

                const btnBg = this.add.rectangle(btnX, btnY, 500, 130, 0x00ffcc)
                    .setInteractive({ useHandCursor: true });

                const btnTxt = this.add.text(btnX, btnY, 'PLAY AGAIN', {
                    fontSize: '50px',
                    fill: '#000'
                }).setOrigin(0.5);

                btnBg.on('pointerdown', () => {
                    this.tweens.add({
                        targets: [btnBg, btnTxt],
                        scale: 0.95,
                        duration: 80,
                        yoyo: true
                    });
                });

                btnBg.on('pointerup', () => {
                    this.scene.start('MainScene');
                });
            }
        }

        const config = {
            type: Phaser.AUTO,
            parent: 'game-container',
            width: CONFIG.width,
            height: CONFIG.height,
            scale: {
                mode: Phaser.Scale.FIT,
                autoCenter: Phaser.Scale.CENTER_BOTH
            },
            scene: [MainScene, GameOverScene],
            backgroundColor: '#0a0a0a'
        };

        new Phaser.Game(config);
    </script>
</body>
</html>
